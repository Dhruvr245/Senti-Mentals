<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAMA - Sentiment Analysis for MCA Amendments</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;500;700&family=Merriweather:wght@400;700&family=Noto+Serif+Devanagari:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wordcloud2.js/1.2.2/wordcloud2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Lora', 'Merriweather', 'Georgia', serif;
            line-height: 1.6;
            color: #2D2D2D;
        }

        /* Navigation */
        .navbar {
            background: #0B1626;
            color: #F8F1E9;
            padding: 1rem 0;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            transition: box-shadow 0.3s ease;
        }

        .navbar.scrolled {
            box-shadow: 0 6px 18px rgba(0,0,0,0.12);
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo i {
            color: #E76F51;
            font-size: 1.8rem;
        }

        .logo h2 {
            margin: 0;
            font-weight: 700;
            color: #F8F1E9;
        }

        .hamburger {
            display: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #F8F1E9;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 30px;
        }

        .nav-links.active {
            display: flex;
        }

        .nav-links a {
            color: #F8F1E9;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            padding: 8px 16px;
            border-radius: 5px;
        }

        .nav-links a:hover, .nav-links a.active {
            background: #E76F51;
            color: #F8F1E9;
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, #1B263B 0%, #2A3A5C 100%);
            color: #F8F1E9;
            padding: 130px 20px 90px;
            text-align: center;
            position: relative;
            overflow: hidden;
            border-bottom: 1px solid #E0E0E0;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="pattern" width="50" height="50" patternUnits="userSpaceOnUse"><rect x="0" y="0" width="25" height="25" fill="none" stroke="%23E0E0E0" stroke-width="0.5"/><rect x="25" y="25" width="25" height="25" fill="none" stroke="%23E0E0E0" stroke-width="0.5"/></pattern></defs><rect width="100%" height="100%" fill="url(%23pattern)"/></svg>');
            opacity: 0.1;
        }

        .hero-content {
            position: relative;
            z-index: 2;
            max-width: 800px;
            margin: 0 auto;
        }

        .hero h1 {
            font-size: 3.8rem;
            font-weight: 700;
            margin-bottom: 20px;
            line-height: 1.2;
        }

        .hero .subtitle {
            font-size: 1.6rem;
            margin-bottom: 30px;
            font-weight: 500;
            opacity: 0.9;
            text-shadow: 0 2px 4px rgba(0,0,0,0.15);
        }

        .cta-button {
            background: #E76F51;
            color: #F8F1E9;
            padding: 15px 40px;
            border: none;
            border-radius: 8px;
            font-size: 1.2rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            box-shadow: 0 4px 12px rgba(231, 111, 81, 0.3);
        }

        .cta-button:hover {
            background: #D9482A;
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(231, 111, 81, 0.4);
        }

        /* Stats Section */
        .stats-section {
            padding: 90px 20px;
            background: linear-gradient(135deg, #1B263B 0%, #2A3A5C 100%);
            color: #F8F1E9;
            text-align: center;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 40px;
            margin-top: 40px;
        }

        .stat-item {
            background: #F8F1E9;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            border: 1px solid #E0E0E0;
        }

        .stat-item h3 {
            font-size: 3.2rem;
            font-weight: 700;
            color: #E76F51;
            margin-bottom: 10px;
        }

        .stat-item p {
            font-size: 1.2rem;
            color: #2D2D2D;
            font-weight: 400;
        }

        /* Footer */
        .footer {
            background: #1A1A1A;
            color: #F8F1E9;
            padding: 40px 20px 20px;
            text-align: center;
        }

        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            margin-bottom: 30px;
        }

        .footer-section h4 {
            color: #F8F1E9;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .footer-section ul {
            list-style: none;
        }

        .footer-section li {
            margin: 8px 0;
        }

        .footer-section a {
            color: #F8F1E9;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .footer-section a:hover {
            color: #E76F51;
        }

        .footer-bottom {
            border-top: 1px solid #3A3A3A;
            padding-top: 20px;
            font-size: 0.9rem;
        }

        /* Dashboard Tab */
        .dashboard-tab {
            padding-top: 80px;
            min-height: 100vh;
            background: #f8f9fa;
        }

        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Loading */
        .loading {
            display: none;
            text-align: center;
            padding: 30px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #003366;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Results */
        #results {
            display: none;
        }

        /* Sentiment Stats */
        .sentiment-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: #fff;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .supportive .stat-number { color: #28a745; }
        .opposed .stat-number { color: #dc3545; }
        .critical .stat-number { color: #ffc107; }
        .suggestive .stat-number { color: #17a2b8; }
        .query .stat-number { color: #6f42c1; }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: #fff;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .card:hover {
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
        }

        .card h3 {
            font-size: 1.4rem;
            color: #333;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin: 15px 0;
        }

        .word-cloud-container {
            height: 300px;
            background: #f9f9f9;
            border-radius: 10px;
            margin: 15px 0;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
            font-family: 'Noto Serif Devanagari', 'Lora', serif;
        }

        /* Comments */
        .comments-section {
            background: #fff;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .comment-item {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid;
        }

        .comment-item.supportive { border-color: #28a745; }
        .comment-item.opposed { border-color: #dc3545; }
        .comment-item.critical { border-color: #ffc107; }
        .comment-item.suggestive { border-color: #17a2b8; }
        .comment-item.query { border-color: #6f42c1; }

        .comment-text {
            font-size: 1rem;
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .comment-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #666;
        }

        .sentiment-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.8rem;
        }

        .supportive .sentiment-badge { background: #d4edda; color: #155724; }
        .opposed .sentiment-badge { background: #f8d7da; color: #721c24; }
        .critical .sentiment-badge { background: #fff3cd; color: #856404; }
        .suggestive .sentiment-badge { background: #d1ecf1; color: #0c5460; }
        .query .sentiment-badge { background: #e2e3e5; color: #383d41; }

        /* Reports */
        .reports-section {
            background: #fff;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .report-item {
            background: #f9f9f9;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            border-left: 4px solid #003366;
        }

        .export-section {
            text-align: center;
        }

        /* Filter Section */
        .filter-section {
            text-align: center;
            margin-bottom: 20px;
        }

        .filter-section select {
            padding: 10px;
            font-size: 1rem;
            border-radius: 5px;
            border: 1px solid #003366;
            background: #fff;
            cursor: pointer;
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2.8rem;
            }

            .hero .subtitle {
                font-size: 1.4rem;
            }

            .hamburger {
                display: block;
            }

            .nav-links {
                display: none;
                flex-direction: column;
                position: absolute;
                top: 60px;
                left: 0;
                right: 0;
                background: #0B1626;
                padding: 10px;
            }

            .nav-links.active {
                display: flex;
            }

            .dashboard-grid {
                gap: 30px;
            }
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in-up {
            animation: fadeInUp 0.6s ease forwards;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <i class="fas fa-balance-scale"></i>
                <h2>SAMA</h2>
            </div>
            <div class="hamburger" onclick="toggleMenu()">
                <i class="fas fa-bars"></i>
            </div>
            <ul class="nav-links">
                <li><a href="#" class="active" onclick="showTab('home-tab')">Home</a></li>
                <li><a href="#" onclick="showTab('dashboard-tab'); loadDashboardScripts()">Dashboard</a></li>
            </ul>
        </div>
    </nav>

    <!-- Home Tab -->
    <section id="home-tab" class="tab-content active">
        <section class="hero">
            <div class="hero-content">
                <h1 class="fade-in-up">SAMA</h1>
                <p class="subtitle fade-in-up" style="animation-delay: 0.2s;">Sentiment Analysis for MCA Amendments</p>
                <p style="margin-bottom: 30px; opacity: 0.9; font-size: 1.2rem; font-weight: 400;">AI-Powered Analysis for Ministry of Corporate Affairs E-Consultations</p>
                <a href="#" class="cta-button fade-in-up" style="animation-delay: 0.4s;" onclick="showTab('dashboard-tab'); loadDashboardScripts()">Start Analysing</a>
            </div>
        </section>
        <hr style="border: 0; border-top: 1px solid #E0E0E0; margin: 0;">
        <!-- Stats -->
        <section class="stats-section">
            <div class="container">
                <div class="stats-grid">
                    <div class="stat-item">
                        <h3>95%</h3>
                        <p>Faster Analysis</p>
                    </div>
                    <div class="stat-item">
                        <h3>85%+</h3>
                        <p>Accuracy</p>
                    </div>
                    <div class="stat-item">
                        <h3>50K+</h3>
                        <p>Comments Processed</p>
                    </div>
                </div>
            </div>
        </section>
    </section>

    <!-- Dashboard Tab -->
    <section id="dashboard-tab" class="dashboard-tab tab-content">
        <div class="dashboard-container">
            <h1 style="text-align: center; color: #003366; margin-bottom: 40px;">SAMA Analytics Dashboard</h1>
            <p style="text-align: center; color: #666; margin-bottom: 40px;">Real-time sentiment analysis for MCA amendment consultations</p>

            <!-- Filter Section -->
            <div class="filter-section">
                <label for="stakeholder-filter">Filter by Stakeholder: </label>
                <select id="stakeholder-filter">
                    <option value="all">All</option>
                    <option value="msme">MSME</option>
                    <option value="corporate">Corporate</option>
                    <option value="professional">Professional</option>
                </select>
            </div>

            <!-- Upload Area -->
            <div class="demo-controls" style="background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); margin-bottom: 40px;">
                <div class="upload-area" style="border: 2px dashed #003366; padding: 40px; text-align: center; cursor: pointer;">
                    <i class="fas fa-upload" style="font-size: 2.5rem; color: #003366; margin-bottom: 20px;"></i>
                    <h3 id="upload-text">Upload Policy Draft PDF + Comments CSV</h3>
                    <p id="upload-status">AI will map feedback to sections automatically</p>
                    <input type="file" id="policy-file" accept=".pdf" style="display: none;" onchange="handleFileSelect(this, 'pdf')">
                    <input type="file" id="comments-file" accept=".csv" style="display: none;" onchange="handleFileSelect(this, 'csv')">
                    <button class="cta-button" style="margin-top: 20px; background: #003366; color: white; border-radius: 5px;" onclick="runAnalysis()">Start Analysis</button>
                </div>
            </div>

            <!-- Loading -->
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <h3>AI Processing Feedback...</h3>
                <p>Fine-tuned BERT analyzing bureaucratic language</p>
            </div>

            <!-- Results -->
            <div id="results" style="display: none;">
                <!-- Sentiment Stats -->
                <div class="sentiment-stats">
                    <div class="stat-card supportive">
                        <div class="stat-number" id="supportive-count">0</div>
                        <div>Supportive</div>
                    </div>
                    <div class="stat-card opposed">
                        <div class="stat-number" id="opposed-count">0</div>
                        <div>Opposed</div>
                    </div>
                    <div class="stat-card critical">
                        <div class="stat-number" id="critical-count">0</div>
                        <div>Critical</div>
                    </div>
                    <div class="stat-card suggestive">
                        <div class="stat-number" id="suggestive-count">0</div>
                        <div>Suggestive</div>
                    </div>
                    <div class="stat-card query">
                        <div class="stat-number" id="query-count">0</div>
                        <div>Queries</div>
                    </div>
                </div>

                <!-- Dashboard Grid -->
                <div class="dashboard-grid">
                    <div class="card">
                        <h3><i class="fas fa-chart-pie"></i> Sentiment Distribution</h3>
                        <div class="chart-container">
                            <canvas id="sentimentChart"></canvas>
                        </div>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-chart-bar"></i> Confidence Levels</h3>
                        <div class="chart-container">
                            <canvas id="confidenceChart"></canvas>
                        </div>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-cloud"></i> Positive Word Cloud</h3>
                        <div class="word-cloud-container" id="positive-word-cloud"></div>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-cloud"></i> Negative Word Cloud</h3>
                        <div class="word-cloud-container" id="negative-word-cloud"></div>
                    </div>
                </div>

                <!-- Reports Section -->
                <div class="reports-section">
                    <h3><i class="fas fa-file-alt"></i> Instant Reports</h3>
                    <div class="report-item">
                        <h4>Top 10 Suggestions for Section 3.2</h4>
                        <ul style="list-style: none; padding-left: 0;">
                            <li>✓ Add digital verification for compliance</li>
                            <li>✓ Include MSME-specific exemptions</li>
                            <li>✓ Integrate blockchain for transparency</li>
                            <li>✓ Simplify reporting requirements</li>
                            <li>✓ Add grace period for implementation</li>
                            <li>✓ Incorporate stakeholder consultation mechanism</li>
                            <li>✓ Enhance data privacy safeguards</li>
                            <li>✓ Provide training resources for corporates</li>
                            <li>✓ Link with GST portal for seamless compliance</li>
                            <li>✓ Include performance metrics for evaluation</li>
                        </ul>
                    </div>
                    <div class="report-item">
                        <h4>Main Implementation Concerns</h4>
                        <ul style="list-style: none; padding-left: 0;">
                            <li>⚠ Timeline too aggressive for small firms</li>
                            <li>⚠ Training requirements for staff</li>
                            <li>⚠ Cost implications for rural corporates</li>
                            <li>⚠ Technical infrastructure needs</li>
                            <li>⚠ Integration with existing systems</li>
                            <li>⚠ Potential for increased litigation</li>
                            <li>⚠ Resource allocation for monitoring</li>
                            <li>⚠ Impact on foreign investments</li>
                            <li>⚠ Clarity on penalty provisions</li>
                            <li>⚠ Support for digital transition</li>
                        </ul>
                    </div>
                </div>

                <!-- Comments -->
                <div class="comments-section">
                    <h3><i class="fas fa-comments"></i> Mapped Feedback</h3>
                    <div id="comments-container"></div>
                </div>

                <!-- Export -->
                <div class="export-section">
                    <button class="cta-button" style="background: #003366; color: white; border-radius: 5px;" onclick="generatePDF()">Generate PDF Report</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h4>SAMA</h4>
                <p>Sentiment Analysis for MCA Amendments</p>
                <p>SIH 2025 | Team Senti-mentals</p>
            </div>
            <div class="footer-section">
                <h4>Quick Links</h4>
                <ul>
                    <li><a href="#" onclick="showTab('home-tab')">Home</a></li>
                    <li><a href="#" onclick="showTab('dashboard-tab'); loadDashboardScripts()">Dashboard</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>MCA Reference</h4>
                <ul>
                    <li><a href="https://www.mca.gov.in/content/mca/global/en/home.html" target="_blank">MCA Portal</a></li>
                    <li><a href="https://www.mca.gov.in/content/mca/global/en/acts-rules/ebooks/companies-act-2013.html" target="_blank">Companies Act 2013</a></li>
                    <li><a href="https://www.mca.gov.in/content/mca/global/en/contact-us/feedback.html" target="_blank">E-Consultation Guidelines</a></li>
                    <li><a href="https://sih.gov.in/" target="_blank">SIH 2025</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>Contact</h4>
                <p>Email: team@sama-analytics.in</p>
                <p>Phone: +91-XXXXXXXXXX</p>
                <div style="margin-top: 15px;">
                    <a href="#" style="margin: 0 10px;"><i class="fab fa-linkedin" style="font-size: 1.5rem;"></i></a>
                    <a href="#" style="margin: 0 10px;"><i class="fab fa-github" style="font-size: 1.5rem;"></i></a>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 SAMA Analytics. All rights reserved. | Smart India Hackathon 2025 Participant</p>
        </div>
    </footer>

    <script>
        // Navigation and Tab Handling
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.getElementById(tabId).classList.add('active');
            
            document.querySelectorAll('.nav-links a').forEach(link => {
                link.classList.remove('active');
            });
            const activeLink = document.querySelector(`.nav-links a[onclick*="${tabId}"]`);
            if (activeLink) activeLink.classList.add('active');
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function toggleMenu() {
            document.querySelector('.nav-links').classList.toggle('active');
        }

        window.addEventListener('scroll', () => {
            document.querySelector('.navbar').classList.toggle('scrolled', window.scrollY > 50);
        });

        // Lazy Load Dashboard Scripts
        function loadDashboardScripts() {
            // Check and load WordCloud if not available
            if (typeof WordCloud === 'undefined') {
                const wordCloudScript = document.createElement('script');
                wordCloudScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/wordcloud2.js/1.2.2/wordcloud2.min.js';
                wordCloudScript.onload = function() {
                    console.log('WordCloud library loaded successfully');
                };
                wordCloudScript.onerror = function() {
                    console.error('Failed to load WordCloud library');
                };
                document.head.appendChild(wordCloudScript);
            }
        }

        // Sample Data with More Hindi Comments
        let sampleData = [
            { text: "Pursuant to Section 3.2, this amendment is supportive as it improves governance for MSMEs. यह संशोधन उत्कृष्ट है।", sentiment: "supportive", confidence: 0.92, section: "3.2", stakeholder: "msme" },
            { text: "Not withstanding the provisions in Section 4.1, the timeline is too short. Critical concern for implementation. समयसीमा बहुत कम है।", sentiment: "critical", confidence: 0.88, section: "4.1", stakeholder: "corporate" },
            { text: "Strongly opposed to Section 5.3 changes - will increase compliance burden. अनुपालन बोझ बढ़ेगा।", sentiment: "opposed", confidence: 0.85, section: "5.3", stakeholder: "msme" },
            { text: "Suggest adding digital verification in Section 6.2 for better transparency. पारदर्शिता के लिए डिजिटल सत्यापन जोड़ा जाए।", sentiment: "suggestive", confidence: 0.79, section: "6.2", stakeholder: "professional" },
            { text: "Query: What about exemptions in Section 7.1 for startups? स्टार्टअप्स के लिए छूट क्या हैं?", sentiment: "query", confidence: 0.91, section: "7.1", stakeholder: "msme" },
            { text: "Section 3.2 का यह संशोधन बहुत अच्छा है। एमएसएमई के लिए गवर्नेंस सुधारता है। Excellent amendment.", sentiment: "supportive", confidence: 0.94, section: "3.2", stakeholder: "msme" },
            { text: "Section 4.1 में समयसीमा बहुत कम है। कार्यान्वयन के लिए महत्वपूर्ण चिंता। Timeline too short.", sentiment: "critical", confidence: 0.87, section: "4.1", stakeholder: "corporate" },
            { text: "Section 5.3 के बदलावों का कड़ा विरोध - अनुपालन बोझ बढ़ाएगा। Strong opposition.", sentiment: "opposed", confidence: 0.89, section: "5.3", stakeholder: "msme" },
            { text: "Section 6.2 में सुधार उत्कृष्ट हैं। Improves compliance efficiency.", sentiment: "supportive", confidence: 0.90, section: "6.2", stakeholder: "professional" },
            { text: "Section 7.1 में लागत संबंधी चिंताएँ हैं। Cost concerns for corporates.", sentiment: "critical", confidence: 0.86, section: "7.1", stakeholder: "corporate" }
        ];

        // File Upload Handling
        let uploadedData = null;

        function handleFileSelect(input, type) {
            const file = input.files[0];
            if (!file) return;

            if (type === 'pdf' && file.type !== 'application/pdf') {
                alert('Please upload a valid PDF file (max 5MB).');
                input.value = '';
                return;
            }
            if (type === 'csv' && file.type !== 'text/csv') {
                alert('Please upload a valid CSV file (max 5MB).');
                input.value = '';
                return;
            }
            if (file.size > 5 * 1024 * 1024) {
                alert('File size exceeds 5MB limit.');
                input.value = '';
                return;
            }

            if (type === 'pdf') {
                document.getElementById('upload-text').textContent = `PDF: ${file.name}`;
                processPDF(file);
            } else if (type === 'csv') {
                document.getElementById('upload-status').textContent = `CSV: ${file.name}`;
                processCSV(file);
            }
        }

        async function processPDF(file) {
            try {
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                let text = '';
                for (let i = 1; i <= pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const content = await page.getTextContent();
                    text += content.items.map(item => item.str).join(' ') + ' ';
                }
                console.log('Extracted PDF Text:', text); // Use for section mapping
            } catch (error) {
                console.error('PDF processing failed:', error);
                alert('Failed to process PDF. Please try again.');
            }
        }

        function processCSV(file) {
            Papa.parse(file, {
                header: true,
                complete: (result) => {
                    uploadedData = result.data.map(row => ({
                        text: row.comment || '',
                        sentiment: row.sentiment || 'neutral',
                        confidence: parseFloat(row.confidence) || 0.8,
                        section: row.section || 'Unknown',
                        stakeholder: row.stakeholder || 'general'
                    })).filter(row => row.text);
                    console.log('Parsed CSV Data:', uploadedData);
                },
                error: () => {
                    alert('Failed to parse CSV. Please ensure the format is correct.');
                }
            });
        }

        // Dashboard Functionality
        function runAnalysis() {
            document.getElementById('loading').style.display = 'block';
            document.querySelector('.demo-controls').style.display = 'none';
            
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('results').style.display = 'block';
                
                const data = uploadedData || sampleData;
                animateCounters(data);
                renderCharts(data);
                renderWordClouds(data);
                displayComments(data);
            }, 2000);
        }

        function animateCounters(data) {
            const counts = data.reduce((acc, item) => {
                acc[item.sentiment] = (acc[item.sentiment] || 0) + 1;
                return acc;
            }, {});
            
            Object.entries(counts).forEach(([sentiment, count]) => {
                const element = document.getElementById(`${sentiment}-count`);
                if (element) {
                    let current = 0;
                    const interval = setInterval(() => {
                        if (current < count) {
                            current++;
                            element.textContent = current;
                        } else {
                            clearInterval(interval);
                        }
                    }, 200);
                }
            });
        }

        function renderCharts(data) {
            try {
                const counts = data.reduce((acc, item) => {
                    acc[item.sentiment] = (acc[item.sentiment] || 0) + 1;
                    return acc;
                }, {});

                new Chart(document.getElementById('sentimentChart').getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(counts),
                        datasets: [{
                            data: Object.values(counts),
                            backgroundColor: ['#28a745', '#dc3545', '#ffc107', '#17a2b8', '#6f42c1'],
                            borderColor: ['#fff', '#fff', '#fff', '#fff', '#fff'],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { position: 'bottom' },
                            tooltip: { enabled: true }
                        }
                    }
                });

                const avgConfidence = data.reduce((acc, item) => {
                    acc[item.sentiment] = (acc[item.sentiment] || []);
                    acc[item.sentiment].push(item.confidence);
                    return acc;
                }, {});

                const labels = Object.keys(avgConfidence);
                const confData = labels.map(key => avgConfidence[key].reduce((sum, v) => sum + v, 0) / avgConfidence[key].length);

                new Chart(document.getElementById('confidenceChart').getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Avg Confidence',
                            data: confData,
                            backgroundColor: ['#28a745', '#dc3545', '#ffc107', '#17a2b8', '#6f42c1']
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: { y: { beginAtZero: true, max: 1 } },
                        plugins: {
                            legend: { display: false },
                            tooltip: { enabled: true }
                        }
                    }
                });
            } catch (error) {
                console.error('Chart rendering failed:', error);
            }
        }

        function generateWordCloudData(data, isPositive) {
            const filtered = data.filter(item => 
                isPositive ? 
                item.sentiment === 'supportive' : 
                ['critical', 'opposed'].includes(item.sentiment)
            );
            
            const wordFreq = {};
            
            // Enhanced stop words
            const englishStopWords = ['the', 'and', 'for', 'section', 'this', 'with', 'that', 'will', 'are', 'not', 'but', 'can', 'all', 'any', 'had', 'her', 'was', 'one', 'our', 'out', 'day', 'get', 'has', 'him', 'his', 'how', 'man', 'new', 'now', 'old', 'see', 'two', 'who', 'boy', 'did', 'its', 'let', 'put', 'say', 'she', 'too', 'use'];
            const hindiStopWords = ['और', 'के', 'है', 'में', 'का', 'की', 'से', 'को', 'पर', 'यह', 'वह', 'एक', 'हो', 'गया', 'किया', 'लिए', 'होगा', 'जाएगा'];
            
            filtered.forEach(item => {
                // Clean and split text
                const cleanText = item.text.replace(/[^\u0900-\u097F\sa-zA-Z0-9]/g, ' ');
                const words = cleanText.toLowerCase().split(/\s+/);
                
                words.forEach(word => {
                    word = word.trim();
                    
                    // Process English words
                    if (/^[a-zA-Z]+$/.test(word) && word.length > 3 && !englishStopWords.includes(word)) {
                        wordFreq[word] = (wordFreq[word] || 0) + 1;
                    }
                    
                    // Process Hindi words
                    if (/^[\u0900-\u097F]+$/.test(word) && word.length > 2 && !hindiStopWords.includes(word)) {
                        wordFreq[word] = (wordFreq[word] || 0) + 1;
                    }
                });
            });
            
            // Convert to array format and sort by frequency
            const wordArray = Object.entries(wordFreq)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 20)
                .map(([word, freq]) => [word, freq * 10]); // Scale up for better visualization
                
            console.log('Word cloud data:', wordArray);
            return wordArray.length > 0 ? wordArray : [['sample', 50], ['data', 30], ['text', 20]];
        }

        function renderWordClouds(data) {
            try {
                // Clear previous word clouds
                const positiveContainer = document.getElementById('positive-word-cloud');
                const negativeContainer = document.getElementById('negative-word-cloud');
                
                positiveContainer.innerHTML = '';
                negativeContainer.innerHTML = '';
                
                // Check if WordCloud2 is available
                if (typeof WordCloud === 'undefined') {
                    console.error('WordCloud library not loaded');
                    positiveContainer.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #666;">Word Cloud library not loaded</div>';
                    negativeContainer.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #666;">Word Cloud library not loaded</div>';
                    return;
                }
                
                const positiveWords = generateWordCloudData(data, true);
                const negativeWords = generateWordCloudData(data, false);
                
                console.log('Positive words:', positiveWords);
                console.log('Negative words:', negativeWords);
                
                // Render positive word cloud
                if (positiveWords.length > 0) {
                    WordCloud(positiveContainer, {
                        list: positiveWords,
                        gridSize: Math.round(16 * 300 / 1024),
                        weightFactor: function (size) {
                            return Math.pow(size, 2.3) * 300 / 1024;
                        },
                        fontFamily: 'Noto Serif Devanagari, Lora, serif, sans-serif',
                        color: function (word, weight) {
                            const colors = ['#28a745', '#20c997', '#17a2b8', '#007bff', '#6f42c1'];
                            return colors[Math.floor(Math.random() * colors.length)];
                        },
                        rotateRatio: 0.5,
                        backgroundColor: '#f9f9f9',
                        minSize: 12,
                        drawOutOfBound: false
                    });
                } else {
                    positiveContainer.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #666;">No positive words found</div>';
                }
                
                // Render negative word cloud
                if (negativeWords.length > 0) {
                    WordCloud(negativeContainer, {
                        list: negativeWords,
                        gridSize: Math.round(16 * 300 / 1024),
                        weightFactor: function (size) {
                            return Math.pow(size, 2.3) * 300 / 1024;
                        },
                        fontFamily: 'Noto Serif Devanagari, Lora, serif, sans-serif',
                        color: function (word, weight) {
                            const colors = ['#dc3545', '#fd7e14', '#ffc107', '#e83e8c', '#6f42c1'];
                            return colors[Math.floor(Math.random() * colors.length)];
                        },
                        rotateRatio: 0.5,
                        backgroundColor: '#f9f9f9',
                        minSize: 12,
                        drawOutOfBound: false
                    });
                } else {
                    negativeContainer.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #666;">No negative words found</div>';
                }
                
            } catch (error) {
                console.error('Word cloud rendering failed:', error);
                document.getElementById('positive-word-cloud').innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #666;">Error loading word cloud</div>';
                document.getElementById('negative-word-cloud').innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #666;">Error loading word cloud</div>';
            }
        }

        function displayComments(data) {
            const container = document.getElementById('comments-container');
            container.innerHTML = '';
            data.forEach(comment => {
                const div = document.createElement('div');
                div.className = `comment-item ${comment.sentiment}`;
                div.innerHTML = `
                    <div class="comment-text">${comment.text}</div>
                    <div class="comment-meta">
                        <span class="sentiment-badge">${comment.sentiment}</span>
                        <span>Confidence: ${(comment.confidence * 100).toFixed(0)}% | Section: ${comment.section} | Stakeholder: ${comment.stakeholder}</span>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        async function generatePDF() {
            try {
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });
                pdf.setFontSize(16);
                pdf.text('SAMA MCA Amendment Report', 105, 20, { align: 'center' });
                
                const results = document.getElementById('results');
                results.style.height = 'auto';
                const canvas = await html2canvas(results, { scale: 2, scrollY: 0, useCORS: true });
                const imgData = canvas.toDataURL('image/png');
                const imgProps = pdf.getImageProperties(imgData);
                const pdfWidth = pdf.internal.pageSize.getWidth() - 20;
                const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
                pdf.addImage(imgData, 'PNG', 10, 30, pdfWidth, pdfHeight);
                
                pdf.save('sama-mca-report.pdf');
            } catch (error) {
                console.error('PDF generation failed:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        }

        // Stakeholder Filter
        document.getElementById('stakeholder-filter').addEventListener('change', (e) => {
            const value = e.target.value;
            const data = uploadedData || sampleData;
            const filteredData = value === 'all' ? data : data.filter(comment => comment.stakeholder === value);
            document.getElementById('comments-container').innerHTML = '';
            animateCounters(filteredData);
            renderCharts(filteredData);
            renderWordClouds(filteredData);
            displayComments(filteredData);
        });

        // Initial Setup
        document.addEventListener('DOMContentLoaded', () => {
            requestAnimationFrame(() => {
                const elements = document.querySelectorAll('.fade-in-up');
                elements.forEach((el, index) => {
                    el.style.opacity = '0';
                    el.style.transform = 'translateY(20px)';
                    el.style.transition = `all 0.6s ease ${index * 0.1}s`;
                    setTimeout(() => {
                        el.style.opacity = '1';
                        el.style.transform = 'translateY(0)';
                    }, 100);
                });
            });

            // Trigger file inputs on upload area click
            document.querySelector('.upload-area').addEventListener('click', () => {
                document.getElementById('policy-file').click();
            });
            document.getElementById('policy-file').addEventListener('change', () => {
                document.getElementById('comments-file').click();
            });
        });
    </script>
</body>
</html>
